<Window x:Class="SolidWorksSketchViewer.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:SolidWorksSketchViewer"
        mc:Ignorable="d"
        Title="SolidWorks Assembly Modifier" Height="800" Width="1400"
        WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <!-- Converters -->
        <local:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>

        <!-- Styles -->
        <Style x:Key="HeaderTextStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
        </Style>

        <Style x:Key="SectionHeaderStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="0,10,0,5"/>
        </Style>

        <Style x:Key="StatusIndicatorStyle" TargetType="Border">
            <Setter Property="Width" Value="12"/>
            <Setter Property="Height" Value="12"/>
            <Setter Property="CornerRadius" Value="6"/>
            <Setter Property="Margin" Value="5,0"/>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Menu Bar -->
            <RowDefinition Height="Auto"/>
            <!-- Header -->
            <RowDefinition Height="*"/>
            <!-- Main Content -->
            <RowDefinition Height="Auto"/>
            <!-- Status Bar -->
        </Grid.RowDefinitions>

        <!-- Menu Bar -->
        <Menu Grid.Row="0">
            <MenuItem Header="_File">
                <MenuItem Header="_New Project" Command="{Binding NewProjectCommand}"/>
                <MenuItem Header="_Open Project" Command="{Binding OpenProjectCommand}"/>
                <MenuItem Header="_Save Project" Command="{Binding SaveProjectCommand}"/>
                <Separator/>
                <MenuItem Header="_Recent Projects" ItemsSource="{Binding RecentProjects}"/>
                <Separator/>
                <MenuItem Header="E_xit" Command="{Binding ExitCommand}"/>
            </MenuItem>

            <MenuItem Header="_View">
                <MenuItem Header="_Show File Browser" IsCheckable="True" IsChecked="{Binding ShowFileBrowser}"/>
                <MenuItem Header="_Show Results Panel" IsCheckable="True" IsChecked="{Binding ShowResultsPanel}"/>
                <Separator/>
                <MenuItem Header="_Dark Theme" IsCheckable="True" IsChecked="{Binding IsDarkTheme}"/>
            </MenuItem>
            <MenuItem Header="_Help">
                <MenuItem Header="_Documentation" Command="{Binding ShowDocumentationCommand}"/>
                <MenuItem Header="_API Status" Command="{Binding ShowAPIStatusCommand}"/>
                <MenuItem Header="_About" Command="{Binding ShowAboutCommand}"/>
            </MenuItem>
        </Menu>

        <!-- Header -->
        <Border Grid.Row="1" Background="#F0F0F0" Padding="20,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="21*"/>
                    <ColumnDefinition Width="319*"/>
                </Grid.ColumnDefinitions>
                <TextBlock Text="SolidWorks Assembly Modifier" Style="{StaticResource HeaderTextStyle}" 
                          HorizontalAlignment="Left" FontSize="24" Grid.Column="1" Margin="423,0,0,10"/>

            </Grid>
        </Border>

        <!-- Main Content Area -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="300" MinWidth="200"/>
                <!-- File Browser -->
                <ColumnDefinition Width="Auto"/>
                <!-- Splitter -->
                <ColumnDefinition Width="*" MinWidth="400"/>
                <!-- Main Processing Area -->
                <ColumnDefinition Width="Auto"/>
                <!-- Splitter -->
                <ColumnDefinition Width="350" MinWidth="250"/>
                <!-- Results Panel -->
            </Grid.ColumnDefinitions>

            <!-- Left Sidebar - File Browser -->
            <Border Grid.Column="0" BorderBrush="#CCCCCC" BorderThickness="0,0,1,0"
                    Visibility="{Binding ShowFileBrowser, Converter={StaticResource BooleanToVisibilityConverter}}">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Folder Selection -->
                    <StackPanel Grid.Row="0">
                        <TextBlock Text="Working Directory" Style="{StaticResource SectionHeaderStyle}"/>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBox Grid.Column="0" Text="{Binding WorkingDirectory}" 
                                    IsReadOnly="True" Margin="0,0,5,0"/>
                            <Button Grid.Column="1" Content="Browse..." Width="70"
                                    Command="{Binding BrowseDirectoryCommand}"/>
                        </Grid>
                    </StackPanel>

                    <!-- File Lists -->
                    <TabControl Grid.Row="1" Margin="0,10,0,0">
                        <!-- Assembly Files Tab -->
                        <TabItem Header="Assemblies">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <Button Grid.Row="0" Content="Refresh" HorizontalAlignment="Right" 
                                        Margin="0,5" Command="{Binding RefreshAssembliesCommand}"/>

                                <ListBox Grid.Row="1" ItemsSource="{Binding AssemblyFiles}" 
                                         SelectedItem="{Binding SelectedAssemblyFile}">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <Border Padding="5" Margin="2">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>

                                                    <StackPanel Grid.Column="0">
                                                        <TextBlock Text="{Binding FileName}" FontWeight="Bold"/>
                                                        <TextBlock Text="{Binding FileSize}" FontSize="11" 
                              Foreground="Gray"/>
                                                    </StackPanel>
                                                    <Border Grid.Column="1" Style="{StaticResource StatusIndicatorStyle}"
                        Background="{Binding ValidationStatusColor}"/>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                            </Grid>
                        </TabItem>

                        <!-- BOM Files Tab -->
                        <TabItem Header="BOM Files">
                            <ListBox ItemsSource="{Binding BOMFiles}" 
                                     SelectedItem="{Binding SelectedBOMFile}">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <Border Padding="5" Margin="2">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <StackPanel Grid.Column="0">
                                                    <TextBlock Text="{Binding FileName}" FontWeight="Bold"/>
                                                    <TextBlock Text="{Binding FileSize}" FontSize="11" 
                              Foreground="Gray"/>
                                                </StackPanel>
                                                <Border Grid.Column="1" Style="{StaticResource StatusIndicatorStyle}"
                        Background="{Binding ValidationStatusColor}"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </TabItem>

                        <!-- Requirements Files Tab -->
                        <TabItem Header="Requirements">
                            <ListBox ItemsSource="{Binding RequirementsFiles}" 
                                     SelectedItem="{Binding SelectedRequirementsFile}">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <Border Padding="5" Margin="2">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <StackPanel Grid.Column="0">
                                                    <TextBlock Text="{Binding FileName}" FontWeight="Bold"/>
                                                    <TextBlock Text="{Binding FileSize}" FontSize="11" 
                              Foreground="Gray"/>
                                                </StackPanel>
                                                <Border Grid.Column="1" Style="{StaticResource StatusIndicatorStyle}"
                        Background="{Binding ValidationStatusColor}"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </TabItem>
                    </TabControl>
                </Grid>
            </Border>

            <!-- Splitter -->
            <GridSplitter Grid.Column="1" Width="3" HorizontalAlignment="Stretch" 
                         Background="#CCCCCC" Cursor="SizeWE"/>

            <!-- Center Panel - Main Processing Area -->
            <TabControl Grid.Column="2" Margin="10" SelectedIndex="{Binding CurrentProcessingStage}">
                <!-- Stage 1: File Preview -->
                <TabItem Header="File Preview">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel Margin="10">
                            <!-- Assembly Preview -->
                            <Border BorderBrush="#DDDDDD" BorderThickness="1" CornerRadius="5" 
                                    Padding="10" Margin="0,0,0,10"
                                    Visibility="{Binding HasSelectedAssembly, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <StackPanel>
                                    <TextBlock Text="Assembly Preview" Style="{StaticResource SectionHeaderStyle}"/>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <Image Grid.Column="0" Source="{Binding AssemblyThumbnail}" 
                                               Width="100" Height="100" Margin="0,0,10,0"/>

                                        <StackPanel Grid.Column="1">
                                            <TextBlock>
                                                <Run Text="Name: " FontWeight="Bold"/>
                                                <Run Text="{Binding AssemblyName}"/>
                                            </TextBlock>
                                            <TextBlock>
                                                <Run Text="Part Count: " FontWeight="Bold"/>
                                                <Run Text="{Binding AssemblyPartCount}"/>
                                            </TextBlock>
                                            <TextBlock>
                                                <Run Text="File Size: " FontWeight="Bold"/>
                                                <Run Text="{Binding AssemblyFileSize}"/>
                                            </TextBlock>
                                        </StackPanel>
                                    </Grid>
                                </StackPanel>
                            </Border>

                            <!-- BOM Preview -->
                            <Border BorderBrush="#DDDDDD" BorderThickness="1" CornerRadius="5" 
                                    Padding="10" Margin="0,0,0,10"
                                    Visibility="{Binding HasSelectedBOM, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <StackPanel>
                                    <TextBlock Text="Bill of Materials Preview" Style="{StaticResource SectionHeaderStyle}"/>
                                    <DataGrid ItemsSource="{Binding BOMPreviewData}" 
                                             AutoGenerateColumns="False" MaxHeight="200">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Part Name" Binding="{Binding PartName}" Width="*"/>
                                            <DataGridTextColumn Header="Quantity" Binding="{Binding Quantity}" Width="80"/>
                                            <DataGridTextColumn Header="Material" Binding="{Binding Material}" Width="100"/>
                                            <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="*"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </StackPanel>
                            </Border>

                            <!-- Requirements Preview -->
                            <Border BorderBrush="#DDDDDD" BorderThickness="1" CornerRadius="5" 
                                    Padding="10"
                                    Visibility="{Binding HasSelectedRequirements, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <StackPanel>
                                    <TextBlock Text="Requirements Preview" Style="{StaticResource SectionHeaderStyle}"/>
                                    <TextBox Text="{Binding RequirementsText}" 
                                            IsReadOnly="True" TextWrapping="Wrap" 
                                            MaxHeight="300" VerticalScrollBarVisibility="Auto"
                                            FontFamily="Consolas"/>
                                </StackPanel>
                            </Border>

                            <!-- Process Button -->
                            <Button Content="Process Requirements with AI" 
                                    Command="{Binding ProcessRequirementsCommand}"
                                    HorizontalAlignment="Center" Margin="20"
                                    Padding="20,10" FontSize="16"
                                    IsEnabled="{Binding CanProcessRequirements}"/>
                        </StackPanel>
                    </ScrollViewer>
                </TabItem>

                <!-- Stage 2: Requirements Processing -->
                <TabItem Header="AI Analysis">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <!-- Processing Status -->
                        <Border Grid.Row="0" Background="#F0F8FF" CornerRadius="5" Padding="10" Margin="0,0,0,10">
                            <StackPanel>
                                <TextBlock Text="{Binding LLMStatusMessage}" FontSize="16" FontWeight="Bold"/>
                                <ProgressBar Height="20" Margin="0,10" 
                                            IsIndeterminate="{Binding IsLLMProcessing}"
                                            Value="{Binding LLMProgress}" Maximum="100"/>

                                <!-- Processing Steps -->
                                <ItemsControl ItemsSource="{Binding ProcessingSteps}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Margin="20,2">
                                                <Run Text="{Binding Status}"/>
                                                <Run Text="{Binding Message}"/>
                                            </TextBlock>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </StackPanel>
                        </Border>

                        <!-- Analysis Results with specific actions per tab -->
                        <TabControl Grid.Row="1">
                            <!-- Extracted Requirements -->
                            <TabItem Header="Extracted Requirements">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <DataGrid Grid.Row="0" ItemsSource="{Binding ExtractedRequirements}" 
                                             AutoGenerateColumns="False">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Requirement" Binding="{Binding Text}" Width="*"/>
                                            <DataGridTextColumn Header="Type" Binding="{Binding Type}" Width="100"/>
                                            <DataGridTextColumn Header="Confidence" Binding="{Binding Confidence}" Width="80">
                                                <DataGridTextColumn.ElementStyle>
                                                    <Style TargetType="TextBlock">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding Path=IsHighConfidence}" Value="True">
                                                                <Setter Property="Foreground" Value="Green"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding Path=IsLowConfidence}" Value="True">
                                                                <Setter Property="Foreground" Value="Red"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </DataGridTextColumn.ElementStyle>
                                            </DataGridTextColumn>
                                        </DataGrid.Columns>
                                    </DataGrid>

                                    <!-- Action buttons specific to Requirements -->
                                    <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,10,0,0">
                                        <Button Content="Approve All" Command="{Binding ApproveAllCommand}" 
                                               Margin="5" Padding="15,5" IsEnabled="{Binding CanApprove}"/>
                                        <Button Content="Review Each" Command="{Binding ReviewEachCommand}" 
                                               Margin="5" Padding="15,5" IsEnabled="{Binding CanApprove}"/>
                                        <Button Content="Re-analyze" Command="{Binding ReanalyzeCommand}" 
                                               Margin="5" Padding="15,5"/>
                                    </StackPanel>
                                </Grid>
                            </TabItem>

                            <!-- Feature Mapping -->
                            <TabItem Header="Feature Mapping">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <DataGrid Grid.Row="0" ItemsSource="{Binding FeatureMappings}" 
                                             AutoGenerateColumns="False">
                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="Requirement" Binding="{Binding Requirement}" Width="*"/>
                                            <DataGridTextColumn Header="Target Feature" Binding="{Binding TargetFeature}" Width="150"/>
                                            <DataGridTextColumn Header="Current Value" Binding="{Binding CurrentValue}" Width="100"/>
                                            <DataGridTextColumn Header="New Value" Binding="{Binding NewValue}" Width="100"/>
                                            <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="100"/>
                                        </DataGrid.Columns>
                                    </DataGrid>

                                    <!-- Action buttons specific to Feature Mapping -->
                                    <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,10,0,0">
                                        <Button Content="Validate Mappings" Command="{Binding ValidateMappingsCommand}" 
                                               Margin="5" Padding="15,5"/>
                                        <Button Content="Proceed to Processing" Command="{Binding ApproveAllCommand}" 
                                               Margin="5" Padding="15,5" IsEnabled="{Binding CanApprove}"/>
                                    </StackPanel>
                                </Grid>
                            </TabItem>

                            <!-- JSON Preview -->
                            <TabItem Header="Modification JSON">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <TextBox Grid.Row="0" Text="{Binding ModificationJSON}" 
                                            TextWrapping="Wrap" VerticalScrollBarVisibility="Auto"
                                            FontFamily="Consolas" IsReadOnly="{Binding IsJSONReadOnly}"
                                            Margin="0,0,0,5"/>

                                    <!-- JSON-specific controls -->
                                    <StackPanel Grid.Row="1">
                                        <CheckBox Content="Enable Manual Editing" 
                                                 IsChecked="{Binding EnableJSONEditing}" Margin="0,5"/>

                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,10,0,0">
                                            <Button Content="Validate JSON" Command="{Binding ValidateJSONCommand}" 
                                                   Margin="5" Padding="15,5" IsEnabled="{Binding EnableJSONEditing}"/>
                                            <Button Content="Apply Changes" Command="{Binding ApplyJSONCommand}" 
                                                   Margin="5" Padding="15,5" IsEnabled="{Binding EnableJSONEditing}"/>
                                            <Button Content="Reset to Original" Command="{Binding ResetJSONCommand}" 
                                                   Margin="5" Padding="15,5"/>
                                        </StackPanel>
                                    </StackPanel>
                                </Grid>
                            </TabItem>

                            <!-- Conflicts -->
                            <TabItem Header="Conflicts" IsEnabled="False" >
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="94*"/>
                                        <ColumnDefinition Width="79*"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <ListBox Grid.Row="0" ItemsSource="{Binding Conflicts}" Grid.ColumnSpan="2">
                                        <ListBox.ItemTemplate>
                                            <DataTemplate>
                                                <Border BorderBrush="#FF6B6B" BorderThickness="1" 
                                                       CornerRadius="5" Padding="10" Margin="5">
                                                    <StackPanel>
                                                        <TextBlock Text="{Binding Title}" FontWeight="Bold" 
                                                                  Foreground="#FF0000"/>
                                                        <TextBlock Text="{Binding Description}" TextWrapping="Wrap" 
                                                                  Margin="0,5,0,0"/>
                                                        <TextBlock Text="{Binding Resolution}" FontStyle="Italic" 
                                                                  Margin="0,5,0,0"/>
                                                    </StackPanel>
                                                </Border>
                                            </DataTemplate>
                                        </ListBox.ItemTemplate>
                                    </ListBox>

                                    <!-- Conflict resolution actions -->
                                    <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Left" Margin="227,10,0,0" Grid.ColumnSpan="2">
                                        <Button Content="Ignore Conflicts" Command="{Binding IgnoreConflictsCommand}" 
                                               Margin="5" Padding="15,5"/>
                                        <Button Content="Auto-Resolve" Command="{Binding AutoResolveCommand}" 
                                               Margin="5" Padding="15,5"/>
                                    </StackPanel>
                                </Grid>
                            </TabItem>
                        </TabControl>
                    </Grid>
                </TabItem>

                <!-- Stage 3: SolidWorks Processing -->
                <TabItem Header="SolidWorks Processing">
                    <Grid Margin="10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Overall Progress -->
                        <Border Grid.Row="0" Background="#F0FFF0" CornerRadius="5" Padding="10" Margin="0,0,0,10">
                            <StackPanel>
                                <TextBlock Text="{Binding ProcessingStatusMessage}" FontSize="16" FontWeight="Bold"/>
                                <ProgressBar Height="25" Margin="0,10" 
                                            Value="{Binding ProcessingProgress}" Maximum="100">
                                    <ProgressBar.Style>
                                        <Style TargetType="ProgressBar">
                                            <Setter Property="Foreground" Value="#4CAF50"/>
                                        </Style>
                                    </ProgressBar.Style>
                                </ProgressBar>
                                <TextBlock Text="{Binding CurrentOperation}" FontStyle="Italic" HorizontalAlignment="Center"/>
                            </StackPanel>
                        </Border>

                        <!-- Feature Processing List -->
                        <Border Grid.Row="1" BorderBrush="#DDDDDD" BorderThickness="1" CornerRadius="5" Padding="10">
                            <ScrollViewer VerticalScrollBarVisibility="Auto">
                                <ItemsControl ItemsSource="{Binding FeatureProcessingStatus}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Margin="0,2" Padding="10" CornerRadius="3"
                                                   Background="{Binding BackgroundColor}">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="30"/>
                                                        <ColumnDefinition Width="*"/>
                                                        <ColumnDefinition Width="Auto"/>
                                                    </Grid.ColumnDefinitions>

                                                    <TextBlock Grid.Column="0" Text="{Binding StatusIcon}" 
                                                              FontSize="16" VerticalAlignment="Center"/>
                                                    <StackPanel Grid.Column="1" Margin="10,0">
                                                        <TextBlock Text="{Binding FeatureName}" FontWeight="Bold"/>
                                                        <TextBlock Text="{Binding Message}" FontSize="11" 
                                                                  Foreground="Gray"/>
                                                    </StackPanel>
                                                    <TextBlock Grid.Column="2" Text="{Binding ProcessingTime}" 
                                                              FontSize="11" Foreground="Gray"/>
                                                </Grid>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </Border>

                        <!-- Control Buttons -->
                        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,10,0,0">
                            <Button Content="Cancel" Command="{Binding CancelProcessingCommand}" 
                                   Margin="5" Padding="15,5" Background="#FF6B6B" Foreground="White"
                                   IsEnabled="{Binding IsProcessing}"/>
                            <Button Content="Pause" Command="{Binding PauseProcessingCommand}" 
                                   Margin="5" Padding="15,5"
                                   IsEnabled="{Binding CanPauseProcessing}"/>
                            <Button Content="Skip Current" Command="{Binding SkipCurrentCommand}" 
                                   Margin="5" Padding="15,5"
                                   IsEnabled="{Binding IsProcessing}"/>
                        </StackPanel>
                    </Grid>
                </TabItem>
            </TabControl>

            <!-- Splitter -->
            <GridSplitter Grid.Column="3" Width="3" HorizontalAlignment="Stretch" 
                         Background="#CCCCCC" Cursor="SizeWE"/>

            <!-- Right Panel - Results -->
            <Border Grid.Column="4" BorderBrush="#CCCCCC" BorderThickness="1,0,0,0"
                    Visibility="{Binding ShowResultsPanel, Converter={StaticResource BooleanToVisibilityConverter}}">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="10">
                        <!-- Success Summary -->
                        <Border Background="#E8F5E9" CornerRadius="5" Padding="10" Margin="0,0,0,10">
                            <StackPanel>
                                <TextBlock Text="Processing Summary" Style="{StaticResource SectionHeaderStyle}"/>
                                <TextBlock Text="{Binding SuccessSummary}" FontSize="14" TextWrapping="Wrap"/>
                                <TextBlock Text="{Binding ProcessingTime}" FontStyle="Italic" Foreground="Gray" 
                                          Margin="0,5,0,0"/>
                            </StackPanel>
                        </Border>

                        <!-- Change Summary -->
                        <Expander Header="Change Summary" IsExpanded="True" Margin="0,0,0,10">
                            <DataGrid ItemsSource="{Binding ChangeSummary}" 
                                     AutoGenerateColumns="False" MaxHeight="200">
                                <DataGrid.Columns>
                                    <DataGridTextColumn Header="Feature" Binding="{Binding Feature}" Width="*"/>
                                    <DataGridTextColumn Header="Original" Binding="{Binding OriginalValue}" Width="70"/>
                                    <DataGridTextColumn Header="New" Binding="{Binding NewValue}" Width="70"/>
                                    <DataGridTextColumn Header="Status" Binding="{Binding Status}" Width="60"/>
                                </DataGrid.Columns>
                            </DataGrid>
                        </Expander>

                        <!-- Requirements Fulfillment -->
                        <Expander Header="Requirements Status" IsExpanded="True" Margin="0,0,0,10">
                            <ItemsControl ItemsSource="{Binding RequirementsFulfillment}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Margin="0,2" Padding="5" CornerRadius="3"
                                               Background="{Binding BackgroundColor}">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="20"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Grid.Column="0" Text="{Binding StatusIcon}"/>
                                                <TextBlock Grid.Column="1" Text="{Binding Requirement}" 
                                                          TextWrapping="Wrap"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </Expander>

                        <!-- Save Options -->
                        <GroupBox Header="Save Modified Assembly" Margin="0,0,0,10">
                            <StackPanel Margin="5">
                                <TextBlock Text="New Assembly Name:" Margin="0,5,0,2"/>
                                <TextBox Text="{Binding NewAssemblyName}" Margin="0,0,0,10"/>

                                <!-- Save Location Information -->
                                <Border Background="#F0F8FF" CornerRadius="3" Padding="8" Margin="0,5,0,10">
                                    <StackPanel>
                                        <TextBlock Text="Save Location:" FontWeight="SemiBold" Margin="0,0,0,5"/>
                                        <TextBlock Text="{Binding SaveLocationPath}" TextWrapping="Wrap" 
                                                  FontFamily="Consolas" FontSize="11"/>
                                        <TextBlock Text="A new folder will be created with all modified assembly files." 
                                                  FontStyle="Italic" FontSize="11" Foreground="Gray" Margin="0,5,0,0"/>
                                    </StackPanel>
                                </Border>

                                <Button Content="Save Modified Assembly" Command="{Binding SaveAssemblyCommand}" 
                                       Padding="10,5" HorizontalAlignment="Stretch">
                                    <Button.Style>
                                        <Style TargetType="Button">
                                            <Setter Property="Background" Value="#4CAF50"/>
                                            <Setter Property="Foreground" Value="White"/>
                                            <Setter Property="FontWeight" Value="Bold"/>
                                            <Setter Property="Cursor" Value="Hand"/>
                                            <Style.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Background" Value="#45a049"/>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>
                            </StackPanel>
                        </GroupBox>

                        <!-- Export Options -->
                        <GroupBox Header="Export Reports" Margin="0,0,0,10">
                            <StackPanel Margin="5">
                                <Button Content="Export Change Report (PDF)" 
                                       Command="{Binding ExportPDFCommand}" 
                                       Margin="0,2" Padding="5,3"/>
                                <Button Content="Export Change Report (Excel)" 
                                       Command="{Binding ExportExcelCommand}" 
                                       Margin="0,2" Padding="5,3"/>
                                <Button Content="Export Processing Log" 
                                       Command="{Binding ExportLogCommand}" 
                                       Margin="0,2" Padding="5,3"/>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>

        <!-- Status Bar -->
        <StatusBar Grid.Row="3">
            <StatusBar.ItemsPanel>
                <ItemsPanelTemplate>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                    </Grid>
                </ItemsPanelTemplate>
            </StatusBar.ItemsPanel>

            <StatusBarItem Grid.Column="0">
                <StackPanel Orientation="Horizontal">
                    <Ellipse Width="10" Height="10" Fill="{Binding SolidWorksStatusColor}" Margin="0,0,5,0"/>
                    <TextBlock Text="SolidWorks: "/>
                    <TextBlock Text="{Binding SolidWorksStatus}"/>
                </StackPanel>
            </StatusBarItem>

            <Separator Grid.Column="1" Margin="10,0"/>

            <StatusBarItem Grid.Column="2">
                <StackPanel Orientation="Horizontal">
                    <Ellipse Width="10" Height="10" Fill="{Binding LLMStatusColor}" Margin="0,0,5,0"/>
                    <TextBlock Text="LLM API: "/>
                    <TextBlock Text="{Binding LLMStatus}"/>
                </StackPanel>
            </StatusBarItem>

            <StatusBarItem Grid.Column="3" HorizontalAlignment="Center">
                <TextBlock Text="{Binding ProjectStatus}"/>
            </StatusBarItem>

            <StatusBarItem Grid.Column="4">
                <TextBlock Text="{Binding ElapsedTime}"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>